{{ partial "head" . }}

<body>
  <div id="wrap">

    <!-- Header -->
    {{ partial "header" . }}
    {{ if isset .Params "showpagemeta" }}
    {{ .Render "projects" }}
    {{ else }}
    <div class="container">
      <div class="blog-post">
        <h3>
          <strong><a href="{{ .Permalink }}">{{ .Title }}</a></strong>
        </h3>
      </div>
      <div class="blog-title">
        <h4>
          {{ .Date.Format "January 2, 2006" }}
          &nbsp;&nbsp;
          {{ range .Params.tags }}
          <span class="label label-success">{{ . }}</span>
          {{ end }}
        </h4>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="blogpost">
            {{ .Content }}
          </div>
          {{ $related := first 3 ( where ( where .Site.Pages.ByDate.Reverse ".Params.tags" "intersect" .Params.tags ) "Permalink" "!=" .Permalink ) }}
          {{ with $related }}
          <hr>
          <div class="related-posts">
            <h5>Related Posts</h5>
            {{ range . }}
            <div class="row">
              <div class="col-sm-4 col-md-4 col-lg-4">
                <h6 style="text-align: right">
                  {{ .Date.Format "January 2, 2006" }}
                </h6>
              </div>
              <div class="col-sm-8 col-md-8 col-lg-8">
                <h6 style="text-align: left">
                  <strong><a href="{{ .RelPermalink }}">{{ .Title | markdownify }}</a></strong>
                </h6>
              </div>
            </div>
            {{ end }}
          </div>
          {{ end }}
        </div>
      </div>
      <hr>
      <!-- {{ partial "disqus" . }} -->
    </div>
  </div>
  {{ end }}
  </div>

  <!-- Footer -->
  {{ partial "footer" . }}

</body>
<script>
let images = [...document.querySelectorAll('img')]

const interactSettings = {
  root: document.querySelector('body'),
  rootMargin: '0px 0px 200px 0px'
}

function onIntersection(imageEntites) {
  imageEntites.forEach(image => {
    if (image.isIntersecting) {
      observer.unobserve(image.target)
      image.target.src = image.target.dataset.src
      image.target.onload = () => image.target.classList.add('loaded')
    }
  })
}

let observer = new IntersectionObserver(onIntersection, interactSettings)

images.forEach(image => observer.observe(image))

</script>
</html>